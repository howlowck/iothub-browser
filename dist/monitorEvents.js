function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}require("create-hmac");var n=e(require("rhea")),t=function(e){return e.split(";").reduce(function(e,n,t){var o=n.search("="),i=n.slice(0,o),r=n.slice(o+1);return e[i]=r,e},{})},o=function(e){return e.slice(5,-1)},i=e(require("debug"))("monitor-events");module.exports=function(e,r,c){var a,s=t(r),u=o(s.Endpoint),d=s.SharedAccessKeyName,l=s.SharedAccessKey,m="wss://"+u+":443/$servicebus/websocket?iothub-no-client-cert=true",p=n.websocket_connect(WebSocket),f=n.connect({hostname:u,container_id:"conn"+Date.now(),max_frame_size:4294967295,channel_max:65535,idle_timeout:12e4,outgoing_locales:"en-US",incoming_locales:"en-US",offered_capabilities:null,desired_capabilities:null,properties:{},connection_details:p(m,["AMQPWSB10"]),reconnect:!1,username:d,password:l});n.on("connection_open",function(e){f.open_receiver("$management"),a=f.open_sender("$management")}),n.once("sendable",function(n){a.send({body:"[]",application_properties:{operation:"READ",name:e,type:"com.microsoft:eventhub"}})});var b="amqp.annotation.x-opt-enqueuedtimeutc > '"+Date.now()+"'";return n.once("message",function(e){i("monitoring from eventhub endpoint on iothub ..."),e.message.body.partition_ids.forEach(function(e){f.attach_receiver(function(e){return{desired_capabilities:"com.microsoft:enable-receiver-runtime-metric",autoaccept:!0,source:{address:"hao-gl-iothub/ConsumerGroups/$default/Partitions/"+e,filter:{"apache.org:selector-filter:string":n.types.wrap_described(b,77567109365764)}}}}(e))}),n.on("message",function(e){i(e),c(e.message.body.content.toString(),e)})}),{close:f.close.bind(f)}};
//# sourceMappingURL=monitorEvents.js.map
