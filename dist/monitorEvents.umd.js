!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("create-hmac"),require("rhea"),require("debug")):"function"==typeof define&&define.amd?define(["create-hmac","rhea","debug"],n):e.iothubBrowser=n(e.createHmac,e.rhea,e.debug)}(this,function(e,n,t){e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var o=function(e){return e.split(";").reduce(function(e,n,t){var o=n.search("="),r=n.slice(0,o),i=n.slice(o+1);return e[r]=i,e},{})},r=function(e){return e.slice(5,-1)},i=(t=t&&t.hasOwnProperty("default")?t.default:t)("monitor-events");return function(e,t,c){var a,s=o(t),u=r(s.Endpoint),d=s.SharedAccessKeyName,l=s.SharedAccessKey,f="wss://"+u+":443/$servicebus/websocket?iothub-no-client-cert=true",m=n.websocket_connect(WebSocket),p=n.connect({hostname:u,container_id:"conn"+Date.now(),max_frame_size:4294967295,channel_max:65535,idle_timeout:12e4,outgoing_locales:"en-US",incoming_locales:"en-US",offered_capabilities:null,desired_capabilities:null,properties:{},connection_details:m(f,["AMQPWSB10"]),reconnect:!1,username:d,password:l});n.on("connection_open",function(e){p.open_receiver("$management"),a=p.open_sender("$management")}),n.once("sendable",function(n){a.send({body:"[]",application_properties:{operation:"READ",name:e,type:"com.microsoft:eventhub"}})});var b="amqp.annotation.x-opt-enqueuedtimeutc > '"+Date.now()+"'";return n.once("message",function(e){i("monitoring from eventhub endpoint on iothub ..."),e.message.body.partition_ids.forEach(function(e){p.attach_receiver(function(e){return{desired_capabilities:"com.microsoft:enable-receiver-runtime-metric",autoaccept:!0,source:{address:"hao-gl-iothub/ConsumerGroups/$default/Partitions/"+e,filter:{"apache.org:selector-filter:string":n.types.wrap_described(b,77567109365764)}}}}(e))}),n.on("message",function(e){i(e),c(e.message.body.content.toString(),e)})}),{close:p.close.bind(p)}}});
//# sourceMappingURL=monitorEvents.umd.js.map
